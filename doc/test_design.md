# テスト設計書

本プロジェクトにおけるテストの方針と、品質保証のための検証手順について記載します。

## 1. テスト方針
本アプリケーションは、**Unitテスト**（ロジック検証）と **E2Eテスト**（UI/統合検証）の2層で品質を保証します。
CI/CDパイプライン（GitHub Actions）により、コード変更時に自動的にこれらのテストが実行されます。

## 2. テスト環境

### 2.1. Unitテスト環境
*   **対象**: `gacha-logic.js` (確率計算、昇格判定などのコアロジック)
*   **ツール**: **Jest**
*   **実行方法**:
    ```bash
    npm test
    ```
    ※ カバレッジレポートが自動的に生成されます。

### 2.2. E2Eテスト環境
*   **対象**: アプリケーション全体（フロントエンド + バックエンド連携）
*   **ツール**: **Playwright** (Node.js)
*   **実行環境**: Docker Compose によるローカルサーバー (`http://localhost:8000`)
*   **実行方法**:
    ```bash
    # アプリケーション起動
    cd docker && docker-compose up -d --build

    # テスト実行
    npm run test:e2e
    ```

## 3. テストシナリオ

### 3.1. Unitテスト (Logic)
*   **重み付け抽選 (`drawItemByWeight`)**:
    *   重みに応じた確率でアイテムが選出されるか（`Math.random` モックを使用）。
    *   エッジケース（リストが空、重み合計が0など）の挙動。
*   **昇格判定 (`checkPromotion`)**:
    *   設定された確率以下で昇格が発生するか。
    *   確率以上で昇格しないか。

### 3.2. E2Eテスト (UI/Integration)
#### シナリオ: 標準的なガチャ実行フロー
1.  **初期表示**:
    *   **ロジックファイル読み込み確認**: `gacha-logic.js` が正常にロードされていること (Status 200)。
    *   タイトル「伝説の装備ガチャ」が表示される。
    *   ガチャマシン（SVG）がロードされ表示される。
    *   「ガチャを回す」ボタンが有効化される（データロード完了）。
2.  **実行**:
    *   ボタン押下後、ボタンが無効化される。
    *   マシンが揺れるアニメーション (`.animate-shake`) が発生する。
3.  **結果表示**:
    *   一定時間後、結果画面が表示される。
    *   商品名、画像が表示される。
    *   「もう一度回す」ボタンが表示される。

## 4. CI/CD (GitHub Actions)
以下のワークフローが定義されています (`.github/workflows/test.yml`)。

1.  **Unit Tests**: `npm test` を実行。
2.  **Docker Setup**: `docker-compose` でサーバーを起動。
3.  **E2E Tests**: `npm run test:e2e` を実行。
4.  **Artifacts**: テスト失敗時のスクリーンショットやカバレッジレポートを保存。
